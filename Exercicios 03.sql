--GABRIEL ARAUJO FERNANDES

CREATE TABLE PRODUTOS( 
	
	ID SERIAL PRIMARY KEY,
	CODIGO VARCHAR  NOT NULL UNIQUE,
	NOME VARCHAR NOT NULL,
	NOME_NFCE VARCHAR,
	CUSTO NUMERIC(10,2) NOT NULL,
	PRECO NUMERIC (10,2) NOT NULL,
	ESTOQUE INTEGER, 
	DATACADASTRO DATE NOT NULL,
	MARCA VARCHAR,
	CATEGORIA VARCHAR, 
	INATIVO BOOLEAN NOT NULL
	);
	
	CREATE TABLE PEDIDO( 
		
		ID SERIAL PRIMARY KEY,
		NUMEROPEDIDO INTEGER NOT NULL,
		IDPRODUTO INTEGER NOT NULL,
		QTD INTEGER NOT NULL,
		TOTAL NUMERIC (10,2) NOT NULL,
		DATAHORA TIMESTAMP,
		INATIVO BOOLEAN NOT NULL
	);
	
	SELECT * FROM PRODUTOS
	SELECT * FROM PEDIDO
	
-- método 01

INSERT INTO PRODUTOS (ID,CODIGO,NOME,NOME_NFCE,CUSTO,PRECO,ESTOQUE,DATACADASTRO,MARCA,CATEGORIA,INATIVO) 
VALUES  
(1,'A001','Salgadinho Batata 200g','Salgad. Batata 200g',2.20,4.99,1000,'2023-02-01','Pringles','Alimentos',False),        
(2,'A002','Chocolate Barra 90g','Choc. Barra 90g',3.49,5.79,420,'2023-02-01','Lacta','Alimentos',False),       
(3,'E001','Smartphone Motorola octa-core 128gb 8gb Ram','Smart. Mot. octa. 128',999.99,1599.99,80,'2022-12-20','Motorola','Eletronicos',False),       
(4,'E002','Televisao LG Oled 42""','Tel. LG Oled 42""',1439.59,1899.99,250,'2022-12-20','LG','Eletronicos',False),     
(5,'R001','Camisa Basica Preta','Camisa Bas. Preta',19.49,35.99,800,'2023-02-01','Hering','Vestuario',False),     
(6,'R002','Calca Jeans','Calca Jeans',29.99,49.99,560,'2023-02-01','Hering','Vestuario',False),     
(7,'R003','Vestido Curto','Vestido Curto',19.99,39.99,120,'2023-02-01','Element','Vestuario',False),      
(8,'R004','Vestido Longo','Vestido Longo',39.49,59.99,9000,'2022-11-24','Element','Vestuario',False);

TRUNCATE TABLE PRODUTOS;

-- método 02
COPY PRODUTOS (ID,CODIGO,NOME,NOME_NFCE,CUSTO,PRECO,ESTOQUE,DATACADASTRO,MARCA,CATEGORIA,INATIVO)
FROM 'C:\Users\Gabri\Desktop\Arquivos\Faculdade Univale\Banco De Dados\BASE Tabela Produtos.csv' DELIMITER ',' CSV HEADER;

SELECT * FROM PRODUTOS
TRUNCATE TABLE PRODUTOS;

--método 03
INSERT INTO PRODUTOS (ID,CODIGO,NOME,NOME_NFCE,CUSTO,PRECO,ESTOQUE,DATACADASTRO,MARCA,CATEGORIA,INATIVO) 
VALUES  
(DEFAULT,'A001','Salgadinho Batata 200g','Salgad. Batata 200g',2.20,4.99,1000,'2023-02-01','Pringles','Alimentos',False),        
(DEFAULT,'A002','Chocolate Barra 90g','Choc. Barra 90g',3.49,5.79,420,'2023-02-01','Lacta','Alimentos',False),       
(DEFAULT,'E001','Smartphone Motorola octa-core 128gb 8gb Ram','Smart. Mot. octa. 128',999.99,1599.99,80,'2022-12-20','Motorola','Eletronicos',False),       
(DEFAULT,'E002','Televisao LG Oled 42""','Tel. LG Oled 42""',1439.59,1899.99,250,'2022-12-20','LG','Eletronicos',False),     
(DEFAULT,'R001','Camisa Basica Preta','Camisa Bas. Preta',19.49,35.99,800,'2023-02-01','Hering','Vestuario',False),     
(DEFAULT,'R002','Calca Jeans','Calca Jeans',29.99,49.99,560,'2023-02-01','Hering','Vestuario',False),     
(DEFAULT,'R003','Vestido Curto','Vestido Curto',19.99,39.99,120,'2023-02-01','Element','Vestuario',False),      
(DEFAULT,'R004','Vestido Longo','Vestido Longo',39.49,59.99,9000,'2022-11-24','Element','Vestuario',False);

--método mais facil e rapido (copy)

COPY PEDIDO (ID,NUMEROPEDIDO,IDPRODUTO,QTD,TOTAL,DATAHORA,INATIVO)
FROM 'C:\Users\Gabri\Desktop\Arquivos\Faculdade Univale\Banco De Dados\BASE Pedidos.csv' DELIMITER ',' CSV HEADER;
SELECT * FROM PEDIDO

SELECT * FROM PRODUTOS


-- 05
INSERT INTO PRODUTOS (ID,CODIGO,NOME,NOME_NFCE,CUSTO,PRECO,ESTOQUE,DATACADASTRO,MARCA,CATEGORIA,INATIVO)

VALUES
	(DEFAULT,'A001','Coxinga Frango 100g','cox frg 100g',2.00,3.00,500,'2023-03-24','Ruffles','Alimentos',False)
	
--ERROR:  duplicate key value violates unique constraint "produtos_codigo_key"
--DETAIL:  Key (codigo)=(A001) already exists.
--SQL state: 23505

--06
SELECT * FROM PRODUTOS
SELECT * FROM PEDIDO

INSERT INTO PEDIDO (ID, NUMEROPEDIDO,IDPRODUTO,QTD,TOTAL,DATAHORA,INATIVO)
VALUES
	(13,1013,1,5,24.95,CURRENT_DATE,False),
	(14,1013,7,2,79.98,CURRENT_DATE,False),
	(15,1013,6,7,349.93,CURRENT_DATE,False);
	
--07

	INSERT INTO PEDIDO (ID,NUMEROPEDIDO,IDPRODUTO,QTD,TOTAL,DATAHORA,INATIVO)
		
		VALUES	(16,1014,5,4, (SELECT SUM (PRECO * 4) FROM PRODUTOS WHERE ID =  5 OR ID = 6),CURRENT_DATE, FALSE),
				(17,1014,6,3, (SELECT SUM (PRECO * 3)FROM PRODUTOS WHERE ID = 5 OR ID =6),CURRENT_DATE,FALSE);
				
		SELECT * FROM PRODUTOS			
		SELECT * FROM PEDIDO	


--08

 
	SELECT
		  PEDIDO.NUMEROPEDIDO,PRODUTOS.NOME, 
		  CONCAT(PRODUTOS.CODIGO, ' - ', PRODUTOS.CATEGORIA) AS COD_CAT, 
		  TO_CHAR(PRODUTOS.PRECO, 'FM999G999G999D99') AS PRECO_UN, 
		  PEDIDO.QTD, 
		  TO_CHAR(PEDIDO.TOTAL, 'FM999G999G999D99') AS TOTAL, 
		  TO_CHAR(PEDIDO.DATAHORA, 'HH24:MI:SS DD/MM/YYYY') AS DATAHOTA_PEDIDO 
	FROM PEDIDO, PRODUTOS
	WHERE PEDIDO.ID = PRODUTOS.ID;

--09


	SELECT
		  PEDIDO.NUMEROPEDIDO, PRODUTOS.ID,PRODUTOS.CODIGO,PRODUTOS.NOME,
		  PRODUTOS.PRECO::MONEY AS PRECO_UN,
		  PEDIDO.QTD,
		  (PRODUTOS.PRECO * PEDIDO.QTD)::MONEY AS TOTAL_CALC,
		  PEDIDO.TOTAL::MONEY,
		  PEDIDO.TOTAL = (PRODUTOS.PRECO * PEDIDO.QTD) AS VALIDACAO
	FROM PEDIDO, PRODUTOS
	WHERE PEDIDO.IDPRODUTO = PRODUTOS.ID;

	



	SELECT * FROM PRODUTOS			
	SELECT * FROM PEDIDO	


--10

	BEGIN;
		DELETE FROM PRODUTOS WHERE CATEGORIA = 'Vestuario' AND DATACADASTRO >= '2023-01-01';
		SELECT * FROM PRODUTOS;
		
		UPDATE PRODUTOS SET CODIGO = CONCAT('AL',RIGHT(CODIGO,LENGTH(CODIGO)-1)::INTEGER)
		WHERE CODIGO LIKE 'A%';
		SELECT * FROM PRODUTOS ORDER BY NOME, CODIGO, PRECO;

	COMMIT;

	ROLLBACK;
		SELECT * FROM PRODUTOS;





--11
SELECT CODIGO, NOME, PRECO::MONEY,
  CASE WHEN CATEGORIA = 'Eletronicos' THEN
    'R$ ' || TO_CHAR(PRECO * 0.9, 'FM999G999G990D00')
    ELSE 'Sem Promoção! R$ ' || TO_CHAR(PRECO, 'FM999G999G990D00')
  END AS PRECO_PROMOCIONAL,
  CASE WHEN CATEGORIA = 'Eletronicos' THEN
    'R$ ' || TO_CHAR((PRECO * 0.9) - CUSTO, 'FM999G999G990D00')
    ELSE 'Lucro Comum'
  END AS LUCRO
FROM PRODUTOS;